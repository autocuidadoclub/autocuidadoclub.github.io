<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro en AutoCuidado Club</title>
    <link rel="stylesheet" href="styles.css">

     <!-- ✅ Force Load env.js to Prevent Caching Issues -->
    <script src="env.js?v=1.0"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

   

    <script>
  document.addEventListener("DOMContentLoaded", function () {
            if (typeof window._env_ === "undefined" || !window._env_.FIREBASE_API_KEY) {
                console.error("❌ Error: Firebase env.js not loaded.");
                alert("❌ Firebase is not initialized. Check env.js.");
                return;
            }

            const firebaseConfig = {
                apiKey: window._env_.FIREBASE_API_KEY,
                authDomain: window._env_.FIREBASE_AUTH_DOMAIN,
                projectId: window._env_.FIREBASE_PROJECT_ID,
                storageBucket: window._env_.FIREBASE_STORAGE_BUCKET,
                messagingSenderId: window._env_.FIREBASE_MESSAGING_SENDER_ID,
                appId: window._env_.FIREBASE_APP_ID,
                measurementId: window._env_.FIREBASE_MEASUREMENT_ID
            };

            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log("✅ Firebase initialized successfully!");
            } else {
                console.log("ℹ️ Firebase already initialized.");
            }

            const auth = firebase.auth();
            const db = firebase.firestore();

            // ✅ Handle Plan Selection & Show Correct Vehicle Fields
            document.querySelectorAll(".plan-button").forEach(button => {
                button.addEventListener("click", function () {
                    const selectedPlan = this.getAttribute("data-plan");
                    document.getElementById("planType").value = selectedPlan;
                    updateVehicleFields(selectedPlan);
                    
                    // Scroll to registration form
                    document.getElementById("registerForm").scrollIntoView({ behavior: "smooth" });

                    console.log(`✅ Plan seleccionado: ${selectedPlan}`);
                });
            });

            // ✅ Attach Event Listener for Registration Form
            document.getElementById("registerForm").addEventListener("submit", function (event) {
                event.preventDefault();

                const name = document.getElementById("name").value.trim();
                const email = document.getElementById("email").value.trim();
                const phone = document.getElementById("phone").value.trim();
                const password = document.getElementById("password").value.trim();
                const planType = document.getElementById("planType").value;
                const department = document.getElementById("department").value;
                const municipality = document.getElementById("municipality").value;

                const vehicles = [];
                document.querySelectorAll(".vehicle-entry").forEach(entry => {
                    vehicles.push({
                        plate: entry.querySelector(".plate").value,
                        model: entry.querySelector(".model").value,
                        brand: entry.querySelector(".brand").value,
                        year: entry.querySelector(".year").value
                    });
                });

                if (!name || !email || !phone || !password || !department || !municipality) {
                    alert("❌ Todos los campos son obligatorios.");
                    return;
                }

                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const userId = userCredential.user.uid;
                        console.log("✅ Usuario registrado:", userId);

                        return db.collection("users").doc(userId).set({
                            uid: userId,
                            name,
                            email,
                            phone,
                            planType,
                            department,
                            municipality,
                            registrationDate: firebase.firestore.Timestamp.now(),
                            vehicles
                        });
                    })
                    .then(() => {
                        alert("✅ Registro exitoso. Redirigiendo...");
                        window.location.href = "login.html";
                    })
                    .catch((error) => {
                        console.error("❌ Error en el registro:", error.message);
                        alert("❌ Error en el registro: " + error.message);
                    });
            });

        });

        // ✅ Function to Update Vehicle Fields Based on Plan Type
        function updateVehicleFields(planType) {
            const vehicleContainer = document.getElementById("vehicle-container");
            vehicleContainer.innerHTML = ""; // Clear previous entries

            let maxVehicles = (planType.includes("plus")) ? 3 : 1;

            for (let i = 0; i < maxVehicles; i++) {
                const vehicleEntry = document.createElement("div");
                vehicleEntry.classList.add("vehicle-entry");
                vehicleEntry.innerHTML = `
                    <label>Placa:</label>
                    <input type="text" class="plate" required>

                    <label>Modelo:</label>
                    <input type="text" class="model" required>

                    <label>Marca:</label>
                    <input type="text" class="brand" required>

                    <label>Año:</label>
                    <input type="number" class="year" required>
                `;
                vehicleContainer.appendChild(vehicleEntry);
            }
        } 
    </script>

</head>

<body>

     <!-- Subscription Plans -->
    <section>
        
 <h2>Planes de Suscripciones Básicas (cobertura: 1 vehículo)</h2>
        <div class="subscription-row">
 <!-- 3-Month Plan -->
     <div class="plan-item highlight">
        <div class="discount-badge">¡Inicio de Año: Ahorra 30% Solo Febrero!</div>
        <div class="plan-option">
            <img src="3mb.jpg" alt="Plan Básico 3 meses" class="plan-image">
            <p><strong>3 meses:</strong> <s>$34.99</s> <span class="discounted-price">$24.49/mes</span></p>
            <ul class="plan-benefits">
                <li>3 inspecciones preventivas (una cada mes).</li>
                <li><strong>Beneficio:</strong> Ideal para probar el servicio sin compromiso a largo plazo.</li>
                <li><strong>Ideal para:</strong> Clientes nuevos que buscan flexibilidad.</li>
            </ul>
            <p class="limited-time">Promoción válida solo en Febrero, ¡aprovecha hoy mismo!</p>
            <button class="plan-button" data-plan="basic3m">Basic 3M</button>
        </div>
    </div>

    <!-- 6-Month Plan -->
    <div class="plan-item highlight">
        <div class="discount-badge">¡Inicio de Año: Ahorra 15% Solo Febrero!</div>
        <div class="plan-option">
            <img src="6mb.jpg" alt="Plan Básico 6 meses" class="plan-image">
            <p><strong>6 meses:</strong> <s>$32.50</s> <span class="discounted-price">$27.60/mes</span></p>
            <ul class="plan-benefits">
                <li>6 inspecciones preventivas (una cada mes).</li>
                <li><strong>Beneficio:</strong> Ahorro mensual y servicio confiable a mediano plazo.</li>
                <li><strong>Ideal para:</strong> Clientes que buscan equilibrio entre compromiso y flexibilidad.</li>
            </ul>
            <p class="limited-time">Promoción válida solo en Febrero, ¡aprovecha hoy mismo!</p>
             <button class="plan-button" data-plan="basic6m">Basic 6M</button>
        </div>
    </div>


<style>
/* Highlight Plan Badges */
.discount-badge {
    position: absolute;
    top: -10px;
    left: 10px;
    background-color: #FF6600;
    color: white;
    font-weight: bold;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
}

/* Discounted Price */
.discounted-price {
    color: #FF6600;
    font-weight: bold;
    font-size: 1.2em;
}

/* Plan Item Styling */
.plan-item {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    width: 300px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    position: relative;
}
.highlight {
    border: 2px solid #FF6600;
    box-shadow: 0px 4px 10px rgba(255, 102, 0, 0.3);
}

/* Limited-Time Offer Message */
.limited-time {
    color: #FF6600;
    font-size: 0.95em;
    font-style: italic;
    margin-top: 10px;
}

/* Button Styles */
button {
    background-color: #003366;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
button:hover {
    background-color: #FF6600;
}
</style>

              <div class="plan-item">
                   <div class="plan-option">
                    <img src="12mb.jpg" alt="Plan Básico 12 meses" class="plan-image">
                    <p><strong>12 meses:</strong> $30.00/mes</p>
                    <ul class="plan-benefits">
                        <li>12 inspecciones preventivas (una cada mes).</li>
                        <li><strong>Beneficio:</strong> Ahorro mensual y garantía de un mantenimiento constante y sin sorpresas durante el año.</li>
                        <li><strong>Ideal para:</strong> Clientes que están listos para un compromiso a largo plazo con el mantenimiento de su vehículo.</li>
                        <li><strong>Descuento: </strong> 14% de descuento en comparación con el plan básico de 3 meses.</li>
                        </ul>
                      <button class="plan-button" data-plan="basic12m">Basic 12M</button>
            </div>
        </div>
            </div>

        <h2>Planes de Suscripciones Plus (cobertura: 3 vehículos)</h2>
        <div class="subscription-row">
            <div class="plan-item">
                <div class="plan-option">
                    <img src="3mp.jpg" alt="Plan Plus 3 meses" class="plan-image">
                    <p><strong>3 meses:</strong> $70.50/mes (para 3 vehículos)</p>
                    <ul class="plan-benefits">
                        <li>3 inspecciones preventivas para cada vehículo (una cada mes).</li>
                        <li><strong>Beneficio:</strong> Prueba rápida y flexible para clientes con más de un vehículo.</li>
                        <li><strong>Ideal para:</strong> Clientes nuevos o con múltiples vehículos que desean evaluar el servicio.</li>
                        <li><strong>Descuento: </strong> 33% de descuento en comparación con el plan básico de 3 meses por vehículo.</li>
                        </ul>
                     <button class="plan-button" data-plan="plus3m">Plus 3M</button>
                </div>
            </div>
            <div class="plan-item">
                <div class="plan-option">
                    <img src="6mp.jpg" alt="Plan Plus 6 meses" class="plan-image">
                    <p><strong>6 meses:</strong> $66.00/mes (para 3 vehículos)</p>
                    <ul class="plan-benefits">
                        <li>6 inspecciones preventivas para cada vehículo (una cada mes).</li>
                        <li><strong>Beneficio:</strong> Ahorro mensual y consistencia en el mantenimiento para múltiples vehículos.</li>
                        <li><strong>Ideal para:</strong> Clientes que buscan mantener varios vehículos a mediano plazo con eficiencia de costos.</li>
                        <li><strong>Descuento: </strong> 38% de descuento en comparación con el plan básico de 3 meses por vehículo.</li>
                        </ul>
                    <button class="plan-button" data-plan="plus6m">Plus 6M</button>
                </div>
            </div>
             <div class="plan-item">       
                <div class="plan-option">
                    <img src="12mp.jpg" alt="Plan Plus 12 meses" class="plan-image">
                    <p><strong>12 meses:</strong> $60.00/mes (para 3 vehículos)</p>
                    <ul class="plan-benefits">
                        <li>12 inspecciones preventivas para cada vehículo (una cada mes).</li>
                        <li><strong>Beneficio:</strong> Gran ahorro anual y mantenimiento para hasta tres vehículos.</li>
                        <li><strong>Ideal para:</strong> Clientes que buscan mantener varios vehículos a mediano plazo con eficiencia de costos.</li>
                        <li><strong>Descuento: </strong> 42% de descuento en comparación con el plan básico de 3 meses por vehículo, <strong>Equivalente a 5.5 meses gratis</strong></li>
                        </ul>
                    <button class="plan-button" data-plan="plus12m">Plus 12M</button>
                </div>
            </div>
        </div>
    </section>
    
    <h2>Registro en AutoCuidado Club</h2>
    <form id="registerForm" onsubmit="registerUser(event)">
        <label>Nombre:</label>
        <input type="text" id="name" required>

        <label>Email:</label>
        <input type="email" id="email" required>

        <label>Teléfono:</label>
        <input type="text" id="phone" required>

        <label>Contraseña:</label>
        <input type="password" id="password" required>

        <label>Selecciona tu Plan:</label>
        <select id="planType">
            <option value="basic3m">Basic - 1 Vehículo</option>
            <option value="plus3m">Plus - Hasta 3 Vehículos</option>
        </select>

        <div id="vehicle-section">
    <h3>Datos del Vehículo</h3>
    <div id="vehicle-container">
        <div class="vehicle-entry">
            <label for="plate">Placa:</label>
            <input type="text" class="plate" required>

            <label for="model">Modelo:</label>
            <input type="text" class="model" required>

            <label for="brand">Marca:</label>
            <input type="text" class="brand" required>

            <label for="year">Año:</label>
            <input type="number" class="year" required>
        </div>
    </div>
   </div>

        <!-- Schedule Section -->
    <section id="schedule-section" class="schedule-section">
        <h2>Selecciona tu Horario</h2>
        <table class="schedule-table">
    <thead>
        <tr>
            <th>Horario</th>
            <th>Lunes</th>
            <th>Miércoles</th>
            <th>Viernes</th>
            <th>Sábado</th>
            <th>Domingo</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Bloque 1</td>
            <td onclick="selectScheduleBox(this, 'Lunes', '9:00 - 11:00')">9:00 - 11:00</td>
            <td onclick="selectScheduleBox(this, 'Miércoles', '10:00 - 12:00')">10:00 - 12:00</td>
            <td onclick="selectScheduleBox(this, 'Viernes', '13:00 - 15:00')">13:00 - 15:00</td>
            <td onclick="selectScheduleBox(this, 'Sábado', '8:00 - 10:00')">8:00 - 10:00</td>
            <td onclick="selectScheduleBox(this, 'Domingo', '9:00 - 11:00')">9:00 - 11:00</td>
        </tr>
        <tr>
            <td>Bloque 2</td>
            <td onclick="selectScheduleBox(this, 'Lunes', '12:00 - 14:00')">12:00 - 14:00</td>
            <td onclick="selectScheduleBox(this, 'Miércoles', '13:00 - 15:00')">13:00 - 15:00</td>
            <td onclick="selectScheduleBox(this, 'Viernes', '16:00 - 18:00')">16:00 - 18:00</td>
            <td onclick="selectScheduleBox(this, 'Sábado', '11:00 - 13:00')">11:00 - 13:00</td>
            <td onclick="selectScheduleBox(this, 'Domingo', '12:00 - 14:00')">12:00 - 14:00</td>
        </tr>
        <tr>
            <td>Bloque 3</td>
            <td onclick="selectScheduleBox(this, 'Lunes', '15:00 - 17:00')">15:00 - 17:00</td>
            <td onclick="selectScheduleBox(this, 'Miércoles', '16:00 - 18:00')">16:00 - 18:00</td>
            <td onclick="selectScheduleBox(this, '', '')">-</td> <!-- Empty -->
            <td onclick="selectScheduleBox(this, 'Sábado', '14:00 - 16:00')">14:00 - 16:00</td>
            <td onclick="selectScheduleBox(this, '', '')">-</td> <!-- Empty -->
        </tr>
    </tbody>
</table>


        <input type="hidden" id="selectedDay" required>
        <input type="hidden" id="selectedTime" required>

        <div class="card">
    <h3>Seleccione su Ubicación</h3>
    <label for="department">Departamento:</label>
    <select id="department" onchange="updateMunicipalities()" required>
        <option value="">Seleccione un departamento</option>
    </select>
    
    <label for="municipality">Municipio:</label>
    <select id="municipality" required>
        <option value="">Seleccione un municipio</option>
    </select>
    
    
    <script>
       function selectScheduleBox(cell, day, time) {
    // Get the cell's text value
    const timeBlock = cell.innerText.trim();

    // Check if the cell is empty or has a dash (invalid)
    if (!timeBlock || timeBlock === "-") {
        alert("Por favor, seleccione un horario válido.");
        return; // Exit function to prevent selection
    }

    // Remove previous selections
    document.querySelectorAll(".schedule-table td").forEach(td => td.classList.remove("selected"));

    // Highlight the clicked cell
    cell.classList.add("selected");

    // Store selected schedule in hidden inputs
    document.getElementById("selectedDay").value = day;
    document.getElementById("selectedTime").value = time;

    console.log(`✅ Horario seleccionado: ${day} - ${time}`);
}

        const locations = {
            "Ahuachapán": ["Ahuachapán", "Apaneca", "Atiquizaya", "Concepción de Ataco", "El Refugio", "Guaymango", "Jujutla", "San Francisco Menéndez", "San Lorenzo", "San Pedro Puxtla", "Tacuba", "Turín"],
            "Santa Ana": ["Candelaria de la Frontera", "Chalchuapa", "Coatepeque", "El Congo", "El Porvenir", "Masahuat", "Metapán", "San Antonio Pajonal", "San Sebastián Salitrillo", "Santa Ana", "Santa Rosa Guachipilín", "Texistepeque"],
            "Sonsonate": ["Acajutla", "Armenia", "Caluco", "Cuisnahuat", "Izalco", "Juayúa", "Nahuizalco", "Nahulingo", "Salcoatitán", "San Antonio del Monte", "San Julián", "Santa Catarina Masahuat", "Santa Isabel Ishuatán", "Santo Domingo de Guzmán", "Sonsonate", "Sonzacate"],
            "Chalatenango": ["Agua Caliente", "Arcatao", "Azacualpa", "Chalatenango", "Citalá", "Comalapa", "Concepción Quezaltepeque", "Dulce Nombre de María", "El Carrizal", "El Paraíso", "La Laguna", "La Palma", "Las Flores", "Las Vueltas", "Nueva Concepción", "Nueva Trinidad", "Ojos de Agua", "Potonico", "San Antonio de la Cruz", "San Antonio Los Ranchos", "San Fernando", "San Francisco Lempa", "San Francisco Morazán", "San Ignacio", "San Isidro Labrador", "San José Cancasque", "San José Las Flores", "San Luis del Carmen", "San Miguel de Mercedes", "San Rafael", "Santa Rita", "Tejutla"],
            "Cuscatlán": ["Candelaria", "Cojutepeque", "El Carmen", "El Rosario", "Monte San Juan", "Oratorio de Concepción", "San Bartolomé Perulapía", "San Cristóbal", "San José Guayabal", "San Pedro Perulapán", "San Rafael Cedros", "San Ramón", "Santa Cruz Analquito", "Santa Cruz Michapa", "Suchitoto", "Tenancingo"],
            "San Salvador": ["Aguilares", "Apopa", "Ayutuxtepeque", "Ciudad Delgado", "Cuscatancingo", "El Paisnal", "Guazapa", "Ilopango", "Mejicanos", "Nejapa", "Panchimalco", "Rosario de Mora", "San Marcos", "San Martín", "San Salvador", "Santiago Texacuangos", "Santo Tomás", "Soyapango", "Tonacatepeque"],
            "La Libertad": ["Antiguo Cuscatlán", "Chiltiupán", "Ciudad Arce", "Colón", "Comasagua", "Huizúcar", "Jayaque", "Jicalapa", "La Libertad", "Nuevo Cuscatlán", "San Juan Opico", "Quezaltepeque", "Sacacoyo", "San José Villanueva", "San Matías", "San Pablo Tacachico", "Talnique", "Tamanique", "Teotepeque", "Tepecoyo", "Zaragoza"],
            "San Vicente": ["Apastepeque", "Guadalupe", "San Cayetano Istepeque", "San Esteban Catarina", "San Ildefonso", "San Lorenzo", "San Sebastián", "San Vicente", "Santa Clara", "Santo Domingo", "Tecoluca", "Tepetitán", "Verapaz"],
            "Cabañas": ["Cinquera", "Dolores", "Guacotecti", "Ilobasco", "Jutiapa", "San Isidro", "Sensuntepeque", "Tejutepeque", "Victoria"],
            "Usulután": ["Alegría", "Berlín", "California", "Concepción Batres", "El Triunfo", "Ereguayquín", "Estanzuelas", "Jiquilisco", "Jucuapa", "Jucuarán", "Mercedes Umaña", "Nueva Granada", "Ozatlán", "Puerto El Triunfo", "San Agustín", "San Buenaventura", "San Dionisio", "San Francisco Javier", "Santa Elena", "Santa María", "Santiago de María", "Tecapán", "Usulután"],
            "San Miguel": ["Carolina", "Chapeltique", "Chinameca", "Chirilagua", "Ciudad Barrios", "Comacarán", "El Tránsito", "Lolotique", "Moncagua", "Nueva Guadalupe", "Nuevo Edén de San Juan", "Quelepa", "San Antonio", "San Gerardo", "San Jorge", "San Luis de la Reina", "San Miguel", "San Rafael Oriente", "Sesori", "Uluazapa"],
            "Morazán": ["Arambala", "Cacaopera", "Chilanga", "Corinto", "Delicias de Concepción", "El Divisadero", "El Rosario", "Gualococti", "Guatajiagua", "Joateca", "Jocoaitique", "Jocoro", "Lolotiquillo", "Meanguera", "Osicala", "Perquín", "San Carlos", "San Fernando", "San Francisco Gotera", "San Isidro", "San Simón", "Sensembra", "Sociedad", "Torola", "Yamabal", "Yoloaiquín"],
            "La Unión": ["Anamorós", "Bolívar", "Concepción de Oriente", "Conchagua", "El Carmen", "El Sauce", "Intipucá", "La Unión", "Lislique", "Meanguera del Golfo", "Nueva Esparta", "Pasaquina", "Polorós", "San Alejo", "San José", "Santa Rosa de Lima", "Yayantique", "Yucuaiquín"]
        };
        const departmentSelect = document.getElementById("department");
        const municipalitySelect = document.getElementById("municipality");

        // Populate the departments dropdown
        function populateDepartments() {
            for (const department in locations) {
                const option = document.createElement("option");
                option.value = department;
                option.textContent = department;
                departmentSelect.appendChild(option);
            }
        }

        // Update municipalities based on selected department
        function updateMunicipalities() {
            const selectedDepartment = departmentSelect.value;
            municipalitySelect.innerHTML = '<option value="">Seleccione un municipio</option>'; // Reset municipalities

            if (locations[selectedDepartment]) {
                locations[selectedDepartment].forEach(municipality => {
                    const option = document.createElement("option");
                    option.value = municipality;
                    option.textContent = municipality;
                    municipalitySelect.appendChild(option);
                });
            }
        }

        // Initialize departments on page load
        document.addEventListener("DOMContentLoaded", populateDepartments);

        function addVehicle() {
        const vehicleContainer = document.getElementById("vehicle-container");
        if (vehicleContainer.children.length >= 3) {
            alert("Solo puedes agregar hasta 3 vehículos.");
            return;
        }

        const newVehicle = document.createElement("div");
        newVehicle.classList.add("vehicle-entry");
        newVehicle.innerHTML = `
            <label for="plate">Placa:</label>
            <input type="text" class="plate" required>

            <label for="model">Modelo:</label>
            <input type="text" class="model" required>

            <label for="brand">Marca:</label>
            <input type="text" class="brand" required>

            <label for="year">Año:</label>
            <input type="number" class="year" required>

            <button type="button" onclick="removeVehicle(this)">Eliminar</button>
        `;
        vehicleContainer.appendChild(newVehicle);
    }

    function removeVehicle(button) {
        button.parentElement.remove();
    }
        
    </script>

<!-- Checkbox for Terms and Conditions -->
    <div style="margin-top: 15px;">
        <input type="checkbox" id="terms" name="terms" required>
        <label for="terms">
            He leído y acepto los <a href="tac.html" target="_blank">Términos y Condiciones</a>.
        </label>
    </div>
            
        <button type="submit">Registrarse</button>
    </form>

</body>
</html>
