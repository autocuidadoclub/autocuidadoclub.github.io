<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AutoCuidado Home ‚Ä¢ Cat√°logo ESAL</title>

    <!-- Simple reset + your styles (kept small for clarity) -->
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root{
            --blue:#002F6C;
            --orange:#FF6600;
            --accent:#003893;
            --green:#4CAF50;
            --max-width:1000px;
        }
        body{font-family:Inter, system-ui, Arial, sans-serif; margin:0; color:#222; background:#fff; -webkit-font-smoothing:antialiased;}
        .container{max-width:var(--max-width); margin:1.5rem auto; padding:1rem;}
        header.hero{
            background: linear-gradient(135deg, var(--blue), #003B80);
            color:white; padding:48px 20px; border-bottom:4px solid var(--orange);
            text-align:center; border-radius:10px;
        }
        header.hero h1{margin:0 0 8px; font-size:2rem;}
        header.hero p{margin:0; opacity:.95;}

        .top-actions{display:flex; gap:.5rem; justify-content:center; margin:1rem 0 1.5rem; flex-wrap:wrap;}
        .top-actions a{background:var(--orange); color:white; padding:.7rem 1rem; border-radius:8px; font-weight:700; text-decoration:none;}
        .pdf-frame{width:100%; height:520px; border-radius:8px; border:1px solid #eee; box-shadow:0 6px 18px rgba(0,0,0,.06); margin-bottom:1.25rem;}

        /* About & banner */
        .info-row{display:flex; gap:1rem; align-items:center; flex-wrap:wrap; margin-bottom:1rem;}
        .about-card{flex:1; min-width:260px; background:#f9fbff; padding:16px; border-radius:10px; border:1px solid #e6f1ff;}
        .shipping-banner{background:linear-gradient(90deg,#003893,#002F6C); color:white; padding:14px 16px; border-radius:10px; display:flex; gap:12px; align-items:center; justify-content:center; flex:1; min-width:260px;}
        .shipping-banner strong{color:#FFD27A;}

        /* Box / order */
        .box{border:1px solid #eee; padding:18px; border-radius:10px; margin-top:1rem; background:white;}
        .box h2{margin-top:0; color:var(--blue);}
        .summary-row{display:flex; gap:1rem; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-top:12px;}
        .summary-row h3{margin:0;}

        .box label{display:block; margin-top:10px; font-weight:600;}
        .box input[type="text"], .box input[type="number"], .box select{width:100%; padding:9px 10px; border-radius:8px; border:1px solid #d1d5db; box-sizing:border-box;}
        .btn{background:var(--green); color:white; padding:12px 14px; border-radius:10px; font-weight:700; border:none; cursor:pointer; width:100%; margin-top:12px;}
        .btn.secondary{background:var(--orange);}
        .promo{color:green; font-weight:700; margin-top:6px;}

        /* Tables & matrix */
        .order-table-container{margin-bottom:18px; overflow-x:auto;}
        table{width:100%; border-collapse:collapse; min-width:640px;}
        th, td{padding:10px 8px; border:1px solid #eee; vertical-align:middle;}
        thead th{background:#f6f9ff; color:var(--blue); font-weight:700; text-align:center;}
        .product-qty-input{width:68px; text-align:center; padding:6px; border-radius:6px; border:1px solid #ccc;}
        .matrix-scent-cell{font-weight:600; width:190px; text-align:left;}
        .matrix-size-cell{text-align:center; width:100px;}
        .product-group-header{background:#e9f6ff; color:var(--blue); font-weight:800; text-align:center;}

        /* Accordion */
        .accordion{border-radius:10px; overflow:hidden; border:1px solid #eee; margin-bottom:12px;}
        .accordion .acc-header{display:flex; justify-content:space-between; align-items:center; padding:12px 14px; background:#fff; cursor:pointer;}
        .acc-header h4{margin:0; color:var(--blue);}
        .acc-content{display:none; padding:12px 14px; background:white;}

        /* Footer & small screens */
        footer{padding:18px 8px; text-align:center; color:#666; margin-top:18px;}
        @media (max-width:720px){
            .pdf-frame{height:380px;}
            table{min-width:520px;}
            .info-row{flex-direction:column;}
        }
    </style>
</head>
<body>
    <nav style="background:#fff; border-bottom:1px solid #eee; padding:.6rem 0;">
        <div class="container" style="display:flex; align-items:center; gap:12px;">
            <a href="/" style="text-decoration:none; color:var(--accent); font-weight:800; display:flex; align-items:center; gap:8px;">
                <img src="logo.jpg" alt="logo" style="height:36px; border-radius:6px; object-fit:cover;">
                AutoCuidado Club
            </a>
            <div style="margin-left:auto;">
                <a href="/ecosystem" class="divisiones-badge" style="text-decoration:none; color:#003893; font-weight:700;">CONOCE NUESTRAS DIVISIONES</a>
            </div>
        </div>
    </nav>

    <header class="hero">
        <div class="container">
            <h1>Bienvenido a AutoCuidado HOME</h1>
            <p>Tu vales oro. Cuidamos tu entorno, tu salud y tu productividad ‚Äî productos ESAL con calidad profesional.</p>
        </div>
    </header>

    <main class="container" role="main">
        <div class="top-actions">
            <a href="/esalcatalog.pdf" target="_blank" download>üì• Descargar PDF</a>
            <a href="/">‚Üê Volver a AutoCuidado Club</a>
        </div>

        <iframe src="/esalcatalog.pdf" class="pdf-frame" allowfullscreen></iframe>

        <!-- Informational Row -->
        <div class="info-row">
            <div class="about-card">
                <h3>Qui√©nes somos</h3>
                <p><strong>Somos fabricantes de productos de limpieza</strong>, adapt√°ndonos a las especificaciones de nuestros clientes. Cada f√≥rmula, empaque y presentaci√≥n se dise√±a para cumplir tus requisitos: calidad profesional hecha en <strong>El Salvador</strong>.</p>
                <ul style="margin:.5rem 0 0 1rem;">
                    <li>Formulaciones personalizadas</li>
                    <li>Empaque y etiquetado seg√∫n necesidad</li>
                    <li>Control de calidad y registro sanitario</li>
                </ul>
            </div>

            <div class="shipping-banner" aria-live="polite">
                <i class="fas fa-truck" style="font-size:26px;"></i>
                <div style="text-align:left;">
                    <div style="font-weight:800;">Env√≠o gratis desde <strong>US$15.00</strong></div>
                    <div style="font-size:.95rem; opacity:.95;">Cobertura: <strong>Todo El Salvador</strong></div>
                </div>
            </div>
        </div>

        <!-- ORDER BOX -->
        <div class="box" id="orderBox">
            <h2>üìã Pedido R√°pido ESAL - AutoCuidado Home</h2>
            <p style="margin-top:0;">Selecciona cantidad por producto. El total y elegibilidad para env√≠o gratis se muestran al instante.</p>

            <!-- Accordion for categories (JS will open/close) -->
            <div id="categoriesAccordion">
                <!-- JS will inject category accordions here -->
            </div>

            <div class="summary-row">
                <div>
                    <h3>Total: $<span id="totalAmount">0.00</span></h3>
                    <div id="promoMessage" class="promo"></div>
                    <div id="shippingNote" style="font-size:.95rem; color:#333; margin-top:6px;"></div>
                </div>

                <div style="min-width:220px;">
                    <label for="paymentMethod">M√©todo de Pago:</label>
                    <select id="paymentMethod" required>
                        <option value="" disabled selected>Selecciona un m√©todo</option>
                        <option value="Transferencia bancaria">Transferencia bancaria</option>
                        <option value="Tarjeta">Tarjeta</option>
                        <option value="Bitcoin">Bitcoin</option>
                        <option value="Banco Agr√≠cola Tasa Cero">Banco Agr√≠cola Tasa Cero (desde $50)</option>
                    </select>
                </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;">
                <div>
                    <label for="name">Nombre de quien recibe:</label>
                    <input type="text" id="name" placeholder="Ej: Mar√≠a L√≥pez" required>
                </div>
                <div>
                    <label for="phone">Tel√©fono (WhatsApp):</label>
                    <input type="text" id="phone" placeholder="503 7xxxxxxx" required>
                </div>

                <div>
                    <label for="department">Departamento:</label>
                    <input list="departments" id="department" placeholder="Ej: San Salvador" />
                    <datalist id="departments">
                        <option value="San Salvador"></option>
                        <option value="Santa Ana"></option>
                        <option value="San Miguel"></option>
                        <option value="La Libertad"></option>
                        <option value="Cuscatl√°n"></option>
                        <option value="La Uni√≥n"></option>
                    </datalist>
                </div>

                <div>
                    <label for="municipality">Municipio:</label>
                    <input list="municipalities" id="municipality" placeholder="Ej: Antiguo Cuscatl√°n" />
                    <datalist id="municipalities">
                        <option value="San Salvador"></option>
                        <option value="Antiguo Cuscatl√°n"></option>
                        <option value="Santa Tecla"></option>
                        <option value="Santa Ana"></option>
                        <option value="San Miguel"></option>
                        <option value="Nueva Concepci√≥n"></option>
                    </datalist>
                </div>

                <div style="grid-column:1 / -1;">
                    <label for="location">Ubicaci√≥n exacta para entrega:</label>
                    <input type="text" id="location" placeholder="Ej: Calle Principal, pasaje, casa #15" required>
                </div>
            </div>

            <button class="btn" onclick="sendOrder()">üì≤ Enviar Pedido por WhatsApp</button>
        </div>
    </main>

    <footer class="container" role="contentinfo">
        <div style="display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap;">
            <img src="/flag-sv.png" alt="El Salvador" style="height:48px; border-radius:6px;">
            <div style="text-align:left;">
                <p style="margin:0; font-weight:700;">AutoCuidado Club ‚Äî Hecho con orgullo en <strong>El Salvador</strong></p>
                <p style="margin:4px 0 0; font-size:.95rem; color:#666;">&copy; 2025 AutoCuidado Club - Todos los derechos reservados.</p>
            </div>
        </div>

        <div style="text-align:center; margin-top:14px;">
            <p><strong>S√≠guenos en:</strong></p>
            <a href="https://www.instagram.com/esal_sv/?hl=en" target="_blank" style="margin-right:14px; color:#E1306C;"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="https://www.facebook.com/esalsv" target="_blank" style="color:#1877F2;"><i class="fab fa-facebook-f fa-2x"></i></a>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script>
    // ---------- PRODUCT DATA (USAR TU LISTA EXISTENTE) ----------
    const ESAL_PRODUCTS = {
        "Alcohol Gel": [
            { id: "ag_galon_mango", size: "Gal√≥n", scent: "Mango", price: 13.50 },
            { id: "ag_galon_manzana", size: "Gal√≥n", scent: "Manzana Verde", price: 13.50 },
            { id: "ag_galon_maracuya", size: "Gal√≥n", scent: "Maracuy√°", price: 13.50 },
            { id: "ag_500ml_mango", size: "500 mL", scent: "Mango", price: 4.50 },
            { id: "ag_120ml_mango", size: "120 mL", scent: "Mango", price: 1.75 },
            { id: "ag_30ml_mango", size: "30 mL", scent: "Mango", price: 1.00 },
            { id: "ag_30ml_silicon_sin", size: "30 mL", scent: "Sin Fragancia (Sin Silic√≥n)", price: 1.00 }
        ],
        "Alcohol L√≠quido": [
            { id: "al_galon_90", size: "Gal√≥n", scent: "90%", price: 12.00, display: "Gal√≥n 90%" },
            { id: "al_galon_70", size: "Gal√≥n", scent: "70%", price: 10.50, display: "Gal√≥n 70%" },
            { id: "al_spray_70", size: "120 mL Spray", scent: "70%", price: 1.75, display: "120 mL Spray 70%" }
        ],
        "Desinfectante Uso Directo (Piso)": [
            { id: "dd_galon_verde", size: "Gal√≥n", scent: "Manzana Verde", price: 3.25 },
            { id: "dd_galon_lavanda", size: "Gal√≥n", scent: "Lavanda", price: 3.25 }
        ],
        "Lej√≠a": [
            { id: "lejia_4", size: "Gal√≥n", scent: "4%", price: 2.50, display: "Gal√≥n 4%" },
            { id: "lejia_6", size: "Gal√≥n", scent: "6%", price: 3.00, display: "Gal√≥n 6%" }
        ],
        "Jab√≥n L√≠quido para Manos": [
            { id: "jl_galon_verde", size: "Gal√≥n", scent: "Manzana Verde", price: 4.00 },
            { id: "jl_500ml_verde", size: "500 mL", scent: "Manzana Verde", price: 1.75 }
        ],
        "Repelente de Insectos": [
            { id: "repelente_120ml", size: "120 mL Spray", scent: "Citronela", price: 3.00, display: "120 mL Spray Citronela" }
        ]
    };

    // Categor√≠as que deben mostrarse en matriz (opcional)
    const matrixCategories = ["Alcohol Gel", "Jab√≥n L√≠quido para Manos"];

    // Umbral de env√≠o gratis (seg√∫n tu pedido)
    const FREE_SHIPPING_THRESHOLD = 15.00;

    // Utilidades para generar inputs
    function generateInput(product, category) {
        const productName = `${category}: ${product.size} (${product.scent || ''})`;
        const displayPrice = product.price.toFixed(2);
        return `
            <input 
                type="number" 
                class="product-qty-input"
                id="${product.id}" 
                min="0" 
                value="0" 
                oninput="updateTotal()" 
                data-price="${displayPrice}"
                data-name="${productName} ($${displayPrice})"
            >`;
    }

    function generateMatrixCategoryHtml(category, products) {
        const sizes = category === "Alcohol Gel" ? ["Gal√≥n", "500 mL", "120 mL", "30 mL"] : ["Gal√≥n", "500 mL"];
        const scents = [...new Set(products.map(p => p.scent))].filter(s => s).sort();
        const productMap = {};
        products.forEach(p => { if (!productMap[p.scent]) productMap[p.scent] = {}; productMap[p.scent][p.size] = p; });

        let html = `<div class="order-table-container"><table><thead>
            <tr class="product-group-header"><th colspan="${sizes.length + 1}">üß¥ ${category}</th></tr>
            <tr><th class="matrix-scent-cell">Aroma/Fragancia</th>`;

        sizes.forEach(size => {
            const example = products.find(p => p.size === size);
            const priceText = example ? `($${example.price.toFixed(2)})` : '';
            html += `<th class="matrix-size-cell">${size}<br>${priceText}</th>`;
        });

        html += `</tr></thead><tbody>`;

        scents.forEach(scent => {
            html += `<tr><td class="matrix-scent-cell">${scent}</td>`;
            sizes.forEach(size => {
                const product = productMap[scent] ? productMap[scent][size] : null;
                const content = product ? generateInput(product, category) : '‚Äî';
                html += `<td class="matrix-size-cell">${content}</td>`;
            });
            html += `</tr>`;
        });

        if (category === "Alcohol Gel") {
            const special = products.find(p => p.scent === "Sin Fragancia (Sin Silic√≥n)");
            if (special) {
                html += `<tr>
                    <td class="matrix-scent-cell">${special.scent}</td>
                    <td>‚Äî</td><td>‚Äî</td><td>‚Äî</td>
                    <td class="matrix-size-cell">${generateInput(special, category)}</td>
                </tr>`;
            }
        }

        html += `</tbody></table></div>`;
        return html;
    }

    function generateVerticalCategoryHtml(category, products) {
        let html = `<div class="order-table-container"><table><thead>
            <tr class="product-group-header"><th colspan="3">üß¥ ${category}</th></tr>
            <tr><th>Producto y Presentaci√≥n</th><th class="text-center">Precio Unitario</th><th class="text-center">Cantidad</th></tr>
        </thead><tbody>`;

        products.forEach(product => {
            const labelText = product.display || `${product.size} ${product.scent ? '('+product.scent+')' : ''}`;
            html += `<tr>
                        <td>${labelText}</td>
                        <td class="text-center">$${product.price.toFixed(2)}</td>
                        <td class="text-center">${generateInput(product, category)}</td>
                    </tr>`;
        });

        html += `</tbody></table></div>`;
        return html;
    }

    // Crear acordeones por categor√≠a
    function initializeProductForm() {
        const accordionRoot = document.getElementById('categoriesAccordion');
        let html = '';
        for (const category in ESAL_PRODUCTS) {
            const products = ESAL_PRODUCTS[category];
            const content = matrixCategories.includes(category) ? generateMatrixCategoryHtml(category, products) : generateVerticalCategoryHtml(category, products);

            html += `<div class="accordion">
                        <div class="acc-header" onclick="toggleAccordion(this)">
                            <h4>üß¥ ${category}</h4>
                            <div class="acc-caret">+</div>
                        </div>
                        <div class="acc-content">${content}</div>
                    </div>`;
        }
        accordionRoot.innerHTML = html;
        // By default open first accordion for convenience
        const first = accordionRoot.querySelector('.accordion .acc-header');
        if (first) first.click();

        updateTotal(); // calcular total inicial
    }

    function toggleAccordion(el) {
        const acc = el.parentElement;
        const content = acc.querySelector('.acc-content');
        const caret = el.querySelector('.acc-caret');
        if (content.style.display === 'block') {
            content.style.display = 'none';
            caret.textContent = '+';
        } else {
            // optionally close other accordions
            document.querySelectorAll('.acc-content').forEach(c => { if (c !== content) c.style.display = 'none'; if (c.parentElement) c.parentElement.querySelector('.acc-caret').textContent = '+'; });
            content.style.display = 'block';
            caret.textContent = '‚àí';
        }
    }

    // Update totals and promo messages
    function updateTotal() {
        let total = 0;
        const inputs = document.querySelectorAll('#categoriesAccordion input[type="number"]');
        inputs.forEach(input => {
            const qty = parseInt(input.value) || 0;
            const price = parseFloat(input.getAttribute('data-price')) || 0;
            total += qty * price;
        });
        document.getElementById("totalAmount").textContent = total.toFixed(2);

        const promo = document.getElementById("promoMessage");
        const shippingNote = document.getElementById("shippingNote");

        if (total >= FREE_SHIPPING_THRESHOLD && total > 0) {
            promo.textContent = "‚úÖ ¬°Tu pedido aplica para ENV√çO GRATIS!";
            shippingNote.textContent = `Env√≠o: Gratis ‚Äî cobertura en todo El Salvador (desde US$${FREE_SHIPPING_THRESHOLD.toFixed(2)}).`;
        } else if (total === 0) {
            promo.textContent = "";
            shippingNote.textContent = `Env√≠o: Aplica env√≠o gratis desde US$${FREE_SHIPPING_THRESHOLD.toFixed(2)}.`;
        } else {
            promo.textContent = "";
            // Mostrar cu√°nto falta para env√≠o gratis
            const falta = (FREE_SHIPPING_THRESHOLD - total);
            shippingNote.textContent = `Te faltan $${falta.toFixed(2)} para env√≠o gratis (desde US$${FREE_SHIPPING_THRESHOLD.toFixed(2)}). Cobertura: todo El Salvador.`;
        }
    }

    // Send order by WhatsApp (build message)
    function sendOrder() {
        const inputs = document.querySelectorAll('#categoriesAccordion input[type="number"]');
        let totalQty = 0;
        let orderDetails = "";
        inputs.forEach(input => {
            const qty = parseInt(input.value) || 0;
            if (qty > 0) {
                const name = input.getAttribute('data-name');
                orderDetails += `* ${qty}x ${name}\n`;
                totalQty += qty;
            }
        });

        const location = document.getElementById("location").value.trim();
        const municipality = document.getElementById("municipality").value.trim();
        const department = document.getElementById("department").value.trim();
        const name = document.getElementById("name").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const paymentMethod = document.getElementById("paymentMethod").value;
        const total = document.getElementById("totalAmount").textContent;
        const whatsappNumber = "50375704428"; // tu n√∫mero

        // Validaci√≥n
        if (totalQty === 0) {
            alert("‚ö†Ô∏è Por favor, selecciona al menos un producto.");
            return;
        }
        if (!location || !municipality || !name || !phone || paymentMethod === "") {
            alert("‚ö†Ô∏è Por favor, completa todos los campos de entrega (incluido tel√©fono) y selecciona un m√©todo de pago.");
            return;
        }

        // Calcular nota de env√≠o
        let shippingNote = "";
        if (parseFloat(total) >= FREE_SHIPPING_THRESHOLD) {
            shippingNote = "Env√≠o: GRATIS (aplica por pedido >= US$" + FREE_SHIPPING_THRESHOLD.toFixed(2) + ")";
        } else {
            shippingNote = "Env√≠o: NO incluido (env√≠o gratis desde US$" + FREE_SHIPPING_THRESHOLD.toFixed(2) + ")";
        }

        // Build message
        let message = `*ORDEN DE PRODUCTOS ESAL - ${new Date().toLocaleDateString('es-SV')}*\n\n`;
        message += `*PRODUCTOS SOLICITADOS:*\n${orderDetails}\n`;
        message += `*TOTAL ESTIMADO:* $${total}\n`;
        message += `*${shippingNote}*\n`;
        message += `*M√âTODO DE PAGO:* ${paymentMethod}\n\n`;
        message += `*DATOS DE ENTREGA:*\nNombre: ${name}\nTel√©fono: ${phone}\nDepartamento: ${department}\nMunicipio: ${municipality}\nUbicaci√≥n: ${location}\n\n`;
        message += `*NOTAS:* (escribe aqu√≠ cualquier instrucci√≥n adicional al confirmar por WhatsApp)`;

        // Abrir WhatsApp
        const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
        window.open(url, "_blank");
    }

    // INICIALIZACI√ìN
    window.addEventListener('load', initializeProductForm);
    </script>

    <!-- Optional scripts you had for PWA / PushEngage / Feedback (kept, but trimmed) -->
    <script>
    (function(w, d) {
        w.PushEngage = w.PushEngage || [];
        w._peq = w._peq || [];
        try {
            PushEngage.push(['init', { appId: '2f304881-8eee-4a7a-a487-6f231bd85ec7' }]);
            var e = d.createElement('script');
            e.src = 'https://clientcdn.pushengage.com/sdks/pushengage-web-sdk.js';
            e.async = true; e.type = 'text/javascript'; d.head.appendChild(e);
        } catch(e){}
    })(window, document);
    </script>

</body>
</html>
