<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AutoCuidado Home ‚Ä¢ Cat√°logo ESAL</title>
  <link rel="stylesheet" href="../styles.css" />
  <style>
    .catalog-container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
      text-align: center;
    }
    .catalog-title {
      font-size: 2rem;
      color: #002b5c;  /* your blue color */
      margin-bottom: 1rem;
    }
    .catalog-description {
      font-size: 1.1rem;
      color: #444;
      margin-bottom: 1.5rem;
    }
    .catalog-buttons {
      margin-bottom: 2rem;
    }
    .catalog-buttons a {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      margin: 0 0.5rem;
      background-color: #ff6600;  /* your orange accent */
      color: white;
      border-radius: 4px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .catalog-buttons a:hover {
      background-color: #e65c00;
    }
    .catalog-embed {
      width: 100%;
      height: 700px;
      border: none;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <header>
    <!-- include your existing header / nav partial -->
    <nav>
      <!-- your nav links ... -->
      <!-- ensure ‚ÄúDivisiones‚Äù dropdown includes this page if needed -->
    </nav>
  </header>

  <div class="catalog-container">
    <h1 class="catalog-title">Cat√°logo AutoCuidado Home ‚Ä¢ ESAL</h1>
    <p class="catalog-description">
      Descubre nuestra l√≠nea de productos de limpieza, desinfectantes, jabones, repelentes y m√°s.  
      Todo lo que necesitas para el cuidado del hogar con la calidad ESAL.
    </p>
    <div class="catalog-buttons">
      <a href="/esalcatalog.pdf" target="_blank" download>üì• Descargar PDF</a>
      <a href="/">‚Üê Volver a AutoCuidado Club</a>
    </div>
    <iframe
      src="/esalcatalog.pdf"
      class="catalog-embed"
      allowfullscreen
    ></iframe>
  </div>

  <!-- Order section -->
 You need to add the `ESAL_PRODUCTS` JSON object directly inside the `<script>` tag, right before the dynamic form generation code.

This ensures that the JavaScript has access to all the product names, IDs, and prices when it runs to build the order form and calculate the total.

Here is the combined, correct placement of the data and the script logic:

```html
<div class="box">
    <h2>Haz tu Pedido de Productos ESAL</h2>

    <div id="product-inputs-container">
        </div>

    <label for="location">Ubicaci√≥n para entrega:</label>
    <input type="text" id="location" placeholder="Ej: Calle Principal, pasaje">

    <label for="municipality">Municipio:</label>
    <input type="text" id="municipality" placeholder="Ej: Santa Ana, San Miguel">

    <label for="name">Nombre de quien recibe:</label>
    <input type="text" id="name">

    <h3>Total: $<span id="totalAmount">0.00</span></h3>
    <p id="promoMessage" style="color: green; font-weight: bold;"></p>

    <label for="paymentMethod">M√©todo de Pago:</label>
    <select id="paymentMethod">
        <option value="Efectivo contra entrega">Efectivo contra entrega</option>
        <option value="Tarjeta">Tarjeta</option>
        <option value="Bitcoin">Bitcoin</option>
        <option value="Banco Agr√≠cola Tasa Cero">Banco Agr√≠cola Tasa Cero (desde $50)</option>
    </select>

    <button class="btn" onclick="sendOrder()">Enviar Pedido por WhatsApp</button>
</div>

<script>
    // ***************************************************************
    // 1. ADD THE ESAL_PRODUCTS DATA HERE
    // ***************************************************************
    const ESAL_PRODUCTS = {
        "Alcohol Gel - Gal√≥n ($13.50)": [
            { id: "ag_galon_mango", scent: "Mango", price: 13.50 },
            { id: "ag_galon_manzana", scent: "Manzana Verde", price: 13.50 },
            { id: "ag_galon_maracuya", scent: "Maracuy√°", price: 13.50 },
            { id: "ag_galon_sandia", scent: "Sand√≠a", price: 13.50 },
            { id: "ag_galon_sinfrag", scent: "Sin Fragancia", price: 13.50 }
        ],
        "Alcohol Gel - 500 mL ($4.50)": [
            { id: "ag_500ml_mango", scent: "Mango", price: 4.50 },
            { id: "ag_500ml_manzana", scent: "Manzana Verde", price: 4.50 },
            { id: "ag_500ml_maracuya", scent: "Maracuy√°", price: 4.50 },
            { id: "ag_500ml_sandia", scent: "Sand√≠a", price: 4.50 },
            { id: "ag_500ml_sinfrag", scent: "Sin Fragancia", price: 4.50 }
        ],
        "Alcohol Gel - 120 mL ($1.75)": [
            { id: "ag_120ml_mango", scent: "Mango", price: 1.75 },
            { id: "ag_120ml_manzana", scent: "Manzana Verde", price: 1.75 },
            { id: "ag_120ml_maracuya", scent: "Maracuy√°", price: 1.75 },
            { id: "ag_120ml_sandia", scent: "Sand√≠a", price: 1.75 },
            { id: "ag_120ml_sinfrag", scent: "Sin Fragancia", price: 1.75 }
        ],
        "Alcohol Gel - 30 mL ($1.00)": [
            { id: "ag_30ml_mango", scent: "Mango", price: 1.00 },
            { id: "ag_30ml_manzana", scent: "Manzana Verde", price: 1.00 },
            { id: "ag_30ml_maracuya", scent: "Maracuy√°", price: 1.00 },
            { id: "ag_30ml_sandia", scent: "Sand√≠a", price: 1.00 },
            { id: "ag_30ml_sinfrag", scent: "Sin Fragancia", price: 1.00 },
            { id: "ag_30ml_silicon_sin", scent: "Sin Fragancia (Sin Silic√≥n)", price: 1.00 }
        ],
        "Alcohol L√≠quido - Gal√≥n": [
            { id: "al_galon_90", scent: "90%", price: 12.00 },
            { id: "al_galon_70", scent: "70%", price: 10.50 }
        ],
        "Alcohol L√≠quido - 120 mL ($1.75)": [
            { id: "al_spray_70", scent: "70% en Spray", price: 1.75 }
        ],
        "Desinfectante Uso Directo - Gal√≥n ($3.25)": [
            { id: "dd_galon_verde", scent: "Manzana Verde", price: 3.25 },
            { id: "dd_galon_sin", scent: "Sin Fragancia", price: 3.25 },
            { id: "dd_galon_lavanda", scent: "Lavanda", price: 3.25 },
            { id: "dd_galon_maracuya", scent: "Maracuy√°", price: 3.25 },
            { id: "dd_galon_limon", scent: "Lim√≥n", price: 3.25 },
            { id: "dd_galon_citronela", scent: "Citronela", price: 3.25 }
        ],
        "Desinfectante Concentrado - Gal√≥n ($4.00)": [
            { id: "dc_galon_verde", scent: "Manzana Verde", price: 4.00 },
            { id: "dc_galon_sin", scent: "Sin Fragancia", price: 4.00 },
            { id: "dc_galon_lavanda", scent: "Lavanda", price: 4.00 },
            { id: "dc_galon_maracuya", scent: "Maracuy√°", price: 4.00 },
            { id: "dc_galon_limon", scent: "Lim√≥n", price: 4.00 },
            { id: "dc_galon_citronela", scent: "Citronela", price: 4.00 }
        ],
        "Lej√≠a - Gal√≥n": [
            { id: "lejia_4", scent: "4% (Baja Concentraci√≥n)", price: 2.50 },
            { id: "lejia_6", scent: "6% (Alta Concentraci√≥n)", price: 3.00 }
        ],
        "Jab√≥n L√≠quido - Gal√≥n ($4.00)": [
            { id: "jl_galon_verde", scent: "Manzana Verde", price: 4.00 },
            { id: "jl_galon_cereza", scent: "Cereza", price: 4.00 },
            { id: "jl_galon_fresa", scent: "Fresa", price: 4.00 },
            { id: "jl_galon_durazno", scent: "Durazno", price: 4.00 },
            { id: "jl_galon_chicle", scent: "Chicle", price: 4.00 }
        ],
        "Jab√≥n L√≠quido - 500 mL ($1.75)": [
            { id: "jl_500ml_verde", scent: "Manzana Verde", price: 1.75 },
            { id: "jl_500ml_cereza", scent: "Cereza", price: 1.75 },
            { id: "jl_500ml_fresa", scent: "Fresa", price: 1.75 },
            { id: "jl_500ml_durazno", scent: "Durazno", price: 1.75 },
            { id: "jl_500ml_chicle", scent: "Chicle", price: 1.75 }
        ],
        "Repelente de Insectos - 120 mL ($3.00)": [
            { id: "repelente_120ml", scent: "Spray Citronela", price: 3.00 }
        ]
    };
    
    // ***************************************************************
    // 2. Dynamic Form Generation (as provided in the last step)
    // ***************************************************************
    const container = document.getElementById('product-inputs-container');
    const allProducts = [];

    // 1. Generate the HTML structure based on the ESAL_PRODUCTS data
    for (const category in ESAL_PRODUCTS) {
        // Create a header for the category (e.g., Alcohol Gel - Gal√≥n)
        const categoryHeader = document.createElement('h4');
        categoryHeader.textContent = category;
        container.appendChild(categoryHeader);

        ESAL_PRODUCTS[category].forEach(product => {
            // Combine name and size/fragrance for the label
            const categoryBaseName = category.split(' - ')[0]; // e.g., "Alcohol Gel"
            const labelText = `${categoryBaseName} - ${product.scent}`;
            
            const label = document.createElement('label');
            label.setAttribute('for', product.id);
            label.textContent = labelText + ` ($${product.price.toFixed(2)}):`;

            const input = document.createElement('input');
            input.setAttribute('type', 'number');
            input.setAttribute('id', product.id);
            input.setAttribute('min', '0');
            input.setAttribute('value', '0');
            input.setAttribute('oninput', 'updateTotal()');
            input.setAttribute('data-price', product.price.toFixed(2));
            input.setAttribute('data-name', labelText); // Store full name for WhatsApp message

            container.appendChild(label);
            container.appendChild(input);

            // Store the ID for easy reference in the total function
            allProducts.push(product.id);
        });
    }

    // ***************************************************************
    // 3. Dynamic Total Calculation Function (as provided)
    // ***************************************************************
    function updateTotal() {
        let total = 0;
        const inputs = document.querySelectorAll('#product-inputs-container input[type="number"]');

        inputs.forEach(input => {
            const qty = parseInt(input.value) || 0;
            const price = parseFloat(input.getAttribute('data-price'));
            total += qty * price;
        });

        document.getElementById("totalAmount").textContent = total.toFixed(2);
        
        const promo = document.getElementById("promoMessage");
        promo.textContent = total >= 50 ? "¬°Aplica para Tasa Cero Banco Agr√≠cola!" : "";
    }

    // ***************************************************************
    // 4. Dynamic WhatsApp Order Function (as provided)
    // ***************************************************************
    function sendOrder() {
        const inputs = document.querySelectorAll('#product-inputs-container input[type="number"]');
        let totalQty = 0;
        let orderDetails = "";

        inputs.forEach(input => {
            const qty = parseInt(input.value) || 0;
            if (qty > 0) {
                const name = input.getAttribute('data-name');
                orderDetails += `üßº ${qty} ${name}\n`;
                totalQty += qty;
            }
        });
        
        const location = document.getElementById("location").value.trim();
        const municipality = document.getElementById("municipality").value.trim();
        const name = document.getElementById("name").value.trim();
        const paymentMethod = document.getElementById("paymentMethod").value;
        const total = document.getElementById("totalAmount").textContent;
        const whatsappNumber = "50375704428"; // Use your actual WhatsApp number

        if (totalQty === 0 || !location || !name) {
            alert("Por favor, selecciona al menos un producto y completa tu nombre y ubicaci√≥n.");
            return;
        }

        let message = `*ORDEN DE PRODUCTOS ESAL üß¥*\n\n`;
        message += `*Productos:*\n${orderDetails}`;
        message += `\n*Total Estimado: $${total}*\n`;
        message += `*M√©todo de Pago:* ${paymentMethod}\n\n`;
        message += `*Entrega:*\nNombre: ${name}\nMunicipio: ${municipality || 'No Especificado'}\nUbicaci√≥n: ${location}`;

        window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`, "_blank");
    }
</script>
```

  
  <footer>
    <!-- your existing footer partial -->
  </footer>


  <!-- CTA Footer -->
<div id="cta-install-bar" style="display:none;">
     <div class="cta-message">
  ¬øQuer√©s contactarnos, dejarnos tu opini√≥n o instalar la app? <strong>Todo lo ten√©s aqu√≠.</strong>
</div>

      <button onclick="openFeedbackModal()">üìù D√©janos tu opini√≥n</button>
      <a href="contacto.html">üí¨ Cont√°cta con nuestro staff</a>
      <button id="how-to-install-btn">üì≤ Instal√° nuestra APP</button>
    <button onclick="closeCtaInstallBar()" class="close-btn">‚ùå Cerrar</button>

    </div>
  </div>

  <!-- Feedback Modal -->
<!-- Feedback Modal -->
<div id="feedbackModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:400px; position:relative;">
  
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <h3 style="margin: 0;">Tu opini√≥n sobre AutoCuidado Club</h3>
    <button onclick="closeFeedbackModal()" style="
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #ff0000;
      font-weight: bold;
    ">‚ùå</button>
  </div>

  <form id="voiceFeedbackForm">
    <input type="hidden" name="_subject" value="Feedback (Fase Family & Friends) - AutoCuidado Club">
    <input type="hidden" name="_cc" value="info@autocuidadoclub.com">
    <textarea id="feedbackText" name="message" rows="5" placeholder="Habla o escribe tu mensaje..." style="width:100%; margin-bottom:10px; resize:vertical;" required></textarea>
    <input type="email" name="email" placeholder="Tu correo (opcional)" style="width:100%; margin-bottom:10px;">
    <div style="display:flex; justify-content:space-between;">
      <button type="button" onclick="startVoiceInput()" style="background-color: #ff6600; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold;">üé§ Hablar</button>
      <button type="submit" style="background-color: #003893; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold;">Enviar</button>
    </div>
  </form>

  <div id="feedbackLoader" style="display:none; margin-top:10px; text-align:center;">
    <img src="loading.gif" alt="Cargando..." style="width:80px;">
  </div>

  </div>
</div>


<!-- Bot√≥n para volver a mostrar el men√∫ -->
<button id="reopen-cta-btn" style="
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #ff9800;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 12px;
  font-weight: bold;
  font-size: 13px;
  cursor: pointer;
  z-index: 9999;
  opacity: 0;
  max-width: 180px;
  width: auto;
  white-space: nowrap;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  transition: opacity 0.3s ease, transform 0.3s ease;
">
üì≤ Abrir men√∫
</button>




  <script>
     let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  // Stop the browser from showing the default prompt
  e.preventDefault();
  deferredPrompt = e;

  // Optional: you could show the button ONLY when install is available
  document.getElementById('how-to-install-btn').style.display = 'inline-block';
});

document.getElementById('how-to-install-btn').addEventListener('click', async () => {
  const isIos = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
  const isAndroid = /android/.test(navigator.userAgent.toLowerCase());

  if (deferredPrompt) {
    // If install is supported, show browser-native prompt
    deferredPrompt.prompt();
    const choiceResult = await deferredPrompt.userChoice;
    if (choiceResult.outcome === 'accepted') {
      console.log('‚úÖ User accepted the install prompt');
    } else {
      console.log('‚ùå User dismissed the install prompt');
    }
    deferredPrompt = null;
  } else if (isIos) {
    alert("üì≤ En iPhone, toca el bot√≥n de compartir en Safari y selecciona 'Agregar a pantalla de inicio'.");
  } else if (isAndroid) {
    alert("üì≤ En Android, abr√≠ el men√∫ de Chrome (‚ãÆ) y seleccion√° 'Agregar a pantalla de inicio'.");
  } else {
    alert("‚ö†Ô∏è Instalaci√≥n no disponible autom√°ticamente en este dispositivo. Pod√©s usar Chrome o Edge para instalar.");
  }
});
    function openFeedbackModal() {
      document.getElementById('feedbackModal').style.display = 'flex';
      document.getElementById('feedbackText').focus();
    }

    function closeFeedbackModal() {
      document.getElementById('feedbackModal').style.display = 'none';
      document.getElementById('voiceFeedbackForm').reset();
      document.getElementById('feedbackLoader').style.display = 'none';
    }

    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
        alert("Tu navegador no soporta reconocimiento de voz.");
        return;
      }

      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'es-ES';

      const feedbackText = document.getElementById('feedbackText');
      feedbackText.placeholder = "üéôÔ∏è Escuchando...";
      feedbackText.style.border = "2px solid orange";

      recognition.onresult = (event) => {
        const result = event.results[0][0].transcript;
        feedbackText.value += (feedbackText.value ? ' ' : '') + result;
        feedbackText.placeholder = "Habla o escribe tu mensaje...";
        feedbackText.style.border = "1px solid #ccc";
      };

      recognition.onerror = (event) => {
        feedbackText.placeholder = "Habla o escribe tu mensaje...";
        feedbackText.style.border = "1px solid #ccc";
        alert("Error de voz: " + event.error);
      };

      recognition.onend = () => {
        feedbackText.placeholder = "Habla o escribe tu mensaje...";
        feedbackText.style.border = "1px solid #ccc";
      };

      recognition.start();
    }

   document.getElementById('reopen-cta-btn').addEventListener('click', () => {
  const ctaBar = document.getElementById('cta-install-bar');
  const reopenBtn = document.getElementById('reopen-cta-btn');

  ctaBar.style.display = 'block';
  ctaBar.style.opacity = '1';
  ctaBar.style.transform = 'translateY(0)';
  reopenBtn.style.display = 'none';
});

      document.getElementById('voiceFeedbackForm').onsubmit = function (e) {
      e.preventDefault();
      document.getElementById('feedbackLoader').style.display = 'block';

      fetch("https://formsubmit.co/ajax/info@autocuidadoclub.com", {
        method: "POST",
        body: new FormData(this)
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById('feedbackLoader').style.display = 'none';
        if (data.success) {
          alert("¬°Gracias por tu opini√≥n!");
          closeFeedbackModal();
        } else {
          alert("Error al enviar. Intenta de nuevo.");
        }
      })
      .catch(() => {
        document.getElementById('feedbackLoader').style.display = 'none';
        alert("Hubo un problema al enviar el mensaje.");
      });
    };

      function closeCtaInstallBar() {
    const ctaBar = document.getElementById('cta-install-bar');
    const reopenBtn = document.getElementById('reopen-cta-btn');

    // Animaci√≥n suave antes de ocultarlo
    ctaBar.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
    ctaBar.style.opacity = '0';
    ctaBar.style.transform = 'translateY(20px)';

    setTimeout(() => {
      ctaBar.style.display = 'none';

      // Mostrar bot√≥n flotante despu√©s de 5 segundos
      setTimeout(() => {
        reopenBtn.style.display = 'block';
        setTimeout(() => {
          reopenBtn.style.opacity = '1';
        }, 10);
      }, 5000);
    }, 300); // esperar a que termine la transici√≥n
  }

      document.getElementById('reopen-cta-btn').addEventListener('click', () => {
  const ctaBar = document.getElementById('cta-install-bar');
  const reopenBtn = document.getElementById('reopen-cta-btn');

  ctaBar.style.display = 'block';
  ctaBar.style.opacity = '1';
  ctaBar.style.transform = 'translateY(0)';
  reopenBtn.style.display = 'none';
});

  </script>

  
</body>
</html>
